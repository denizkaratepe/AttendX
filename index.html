<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yoklama Sistemi Pro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
        }
        
        .content {
            padding: 30px;
        }
        
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: #667eea;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            margin-top: 10px;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #ed64a6 100%);
        }
        
        #qrcode {
            text-align: center;
            padding: 30px;
            background: #f9f9f9;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        #qrcode canvas {
            border: 3px solid #667eea;
            border-radius: 10px;
            padding: 10px;
            background: white;
        }
        
        .info-box {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        .info-box h3 {
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .timer {
            background: #ffe4e1;
            border-left: 4px solid #ff6b6b;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            font-weight: 600;
            color: #d63031;
        }
        
        .student-list {
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 10px;
            margin-top: 20px;
        }
        
        .student-item {
            padding: 10px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .student-item:last-child {
            border-bottom: none;
        }
        
        .student-count {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 10px;
            display: inline-block;
        }
        
        .success-msg {
            background: #4caf50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            font-weight: 600;
        }
        
        .error-msg {
            background: #f44336;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }
        
        .warning-msg {
            background: #ff9800;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .url-input-group {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .url-display {
            background: white;
            padding: 10px;
            border-radius: 5px;
            word-break: break-all;
            margin-top: 10px;
            border: 2px dashed #667eea;
        }
        
        .wifi-status {
            padding: 10px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
            font-weight: 600;
        }
        
        .wifi-connected {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4caf50;
        }
        
        .wifi-error {
            background: #ffebee;
            color: #c62828;
            border: 2px solid #f44336;
        }
        
        .security-badge {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-block;
            margin: 10px 0;
            font-size: 14px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö Geli≈ümi≈ü Yoklama Sistemi</h1>
            <p>WiFi Kontrol√º ile G√ºvenli Yoklama</p>
        </div>
        
        <div class="content">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="showTab('teacher')">üßë‚Äçüè´ √ñƒüretim √úyesi</button>
                <button class="tab-btn" onclick="showTab('student')">üë®‚Äçüéì √ñƒürenci</button>
            </div>
            
            <!-- √ñƒüretim √úyesi Sekmesi -->
            <div id="teacher-tab" class="tab-content active">
                <div id="setup-form">
                    <h2 style="margin-bottom: 20px; color: #333;">Yoklama Ba≈ülat</h2>
                    
                    <div class="url-input-group">
                        <label for="baseUrl" style="color: #667eea;">üìç URL:</label>
                        <input type="text" id="baseUrl" placeholder="https://kullanici.github.io/yoklama" value="">
                    </div>
                    
                    <div class="form-group">
                        <label for="courseName">Ders Adƒ±:</label>
                        <input type="text" id="courseName" placeholder="√∂rn: Bilgisayar Programlama">
                    </div>
                    
                    <div class="form-group">
                        <label for="courseCode">Ders Kodu:</label>
                        <input type="text" id="courseCode" placeholder="√∂rn: BIL101">
                    </div>
                    
                    <div class="form-group">
                        <label for="week">Hafta:</label>
                        <select id="week">
                            <option value="">Hafta Se√ßin</option>
                            <script>
                                for(let i = 1; i <= 14; i++) {
                                    document.write(`<option value="${i}">${i}. Hafta</option>`);
                                }
                            </script>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="duration">Yoklama S√ºresi (dakika):</label>
                        <input type="number" id="duration" value="5" min="1" max="30">
                    </div>
                    
                    <div class="form-group">
                        <label for="wifiName">√úniversite WiFi Adƒ± (Opsiyonel):</label>
                        <input type="text" id="wifiName" placeholder="√∂rn: eduroam, uni-wifi" value="YU-Student">
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            ‚ö° √ñƒürencilerin bu WiFi'ye baƒülƒ± olmasƒ± gerektiƒüi uyarƒ±sƒ± g√∂sterilecek
                        </div>
                    </div>
                    
                    <button class="btn" onclick="startAttendance()">üöÄ Yoklamayƒ± Ba≈ülat</button>
                </div>
                
                <div id="qr-display" style="display: none;">
                    <h2 style="margin-bottom: 20px; color: #333;">QR Kodu G√∂ster</h2>
                    <div id="qrcode"></div>
                    
                    <div class="url-display">
                        <strong>URL:</strong> <span id="qr-url"></span>
                    </div>
                    
                    <div class="info-box">
                        <h3 id="course-info"></h3>
                        <p id="session-code"></p>
                        <div id="wifi-requirement"></div>
                    </div>
                    
                    <div class="timer" id="timer"></div>
                    
                    <div class="student-list" id="student-list">
                        <h3>Yoklama Giren √ñƒürenciler:</h3>
                        <div id="students"></div>
                    </div>
                    
                    <span class="student-count" id="student-count">Toplam: 0 √ñƒürenci</span>
                    
                    <button class="btn btn-secondary" onclick="downloadExcel()">üìä Excel ƒ∞ndir</button>
                    <button class="btn btn-danger" onclick="endSession()">‚ùå Yoklamayƒ± Bitir</button>
                </div>
            </div>
            
            <!-- √ñƒürenci Sekmesi -->
            <div id="student-tab" class="tab-content">
                <h2 style="margin-bottom: 20px; color: #333;">Yoklama Gir</h2>
                
                <div id="wifi-status-display"></div>
                
                <div class="form-group">
                    <label for="sessionInput">Oturum Kodu:</label>
                    <input type="text" id="sessionInput" placeholder="QR koddan otomatik gelecek veya manuel girin">
                </div>
                
                <div class="form-group">
                    <label for="studentNumber">√ñƒürenci Numarasƒ±:</label>
                    <input type="text" id="studentNumber" placeholder="√∂rn: 2021012345">
                </div>
                
                <div class="form-group">
                    <label for="studentName">Ad Soyad:</label>
                    <input type="text" id="studentName" placeholder="√∂rn: Ali Yƒ±lmaz">
                </div>
                
                <button class="btn" onclick="submitAttendance()">‚úÖ Yoklamaya Katƒ±l</button>
                
                <div id="student-message"></div>
            </div>
        </div>
    </div>
    
    <script>
        // Yoklama oturumlarƒ±nƒ± sakla
        let sessions = {};
        let currentSessionCode = null;
        let timerInterval = null;
        
        // URL'den parametreleri oku
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const session = urlParams.get('s');
            const wifi = urlParams.get('w');
            
            if(session) {
                showTab('student');
                document.getElementById('sessionInput').value = session;
                
                // WiFi gereksinimi varsa kontrol et
                if(wifi && wifi !== 'none') {
                    checkWifiConnection(wifi);
                }
            }
        };
        
        function showTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            if(tab === 'teacher') {
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                document.getElementById('teacher-tab').classList.add('active');
            } else {
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('student-tab').classList.add('active');
            }
        }
        
        function generateSessionCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }
        
        function startAttendance() {
            const baseUrl = document.getElementById('baseUrl').value;
            const courseName = document.getElementById('courseName').value;
            const courseCode = document.getElementById('courseCode').value;
            const week = document.getElementById('week').value;
            const duration = parseInt(document.getElementById('duration').value);
            const wifiName = document.getElementById('wifiName').value;
            
            if(!courseName || !courseCode || !week) {
                alert('L√ºtfen t√ºm zorunlu alanlarƒ± doldurun!');
                return;
            }
            
            const sessionCode = generateSessionCode();
            currentSessionCode = sessionCode;
            const endTime = Date.now() + (duration * 60 * 1000);
            
            // Oturumu sakla
            sessions[sessionCode] = {
                courseName,
                courseCode,
                week,
                sessionCode,
                endTime,
                wifiName: wifiName || null,
                startTime: new Date().toLocaleString('tr-TR'),
                students: []
            };
            
            // QR kod URL'sini olu≈ütur
            let qrUrl;
            if(baseUrl) {
                // GitHub Pages URL'si girilmi≈üse
                qrUrl = `${baseUrl}?s=${sessionCode}`;
            } else {
                // Lokal test i√ßin
                const currentUrl = window.location.href.split('?')[0];
                qrUrl = `${currentUrl}?s=${sessionCode}`;
            }
            
            // WiFi parametresini ekle
            if(wifiName) {
                qrUrl += `&w=${encodeURIComponent(wifiName)}`;
            } else {
                qrUrl += `&w=none`;
            }
            
            // QR kodunu olu≈ütur
            document.getElementById('qrcode').innerHTML = '';
            new QRCode(document.getElementById('qrcode'), {
                text: qrUrl,
                width: 250,
                height: 250,
                correctLevel: QRCode.CorrectLevel.L
            });
            
            // URL'yi g√∂ster
            document.getElementById('qr-url').textContent = qrUrl;
            
            // Bilgileri g√∂ster
            document.getElementById('course-info').textContent = `${courseCode} - ${courseName} (${week}. Hafta)`;
            document.getElementById('session-code').innerHTML = `<strong>Oturum Kodu:</strong> ${sessionCode}`;
            
            // WiFi gereksinimini g√∂ster
            if(wifiName) {
                document.getElementById('wifi-requirement').innerHTML = 
                    `<span class="security-badge">üîí WiFi Kontrol√º Aktif: "${wifiName}"</span>`;
            } else {
                document.getElementById('wifi-requirement').innerHTML = 
                    `<span style="color: #ff9800;">‚ö†Ô∏è WiFi kontrol√º aktif deƒüil</span>`;
            }
            
            // Timer ba≈ülat
            startTimer(endTime);
            
            // G√∂r√ºn√ºmleri deƒüi≈ütir
            document.getElementById('setup-form').style.display = 'none';
            document.getElementById('qr-display').style.display = 'block';
        }
        
        function startTimer(endTime) {
            timerInterval = setInterval(() => {
                const remaining = endTime - Date.now();
                if(remaining <= 0) {
                    clearInterval(timerInterval);
                    document.getElementById('timer').textContent = '‚è∞ S√ºre Doldu! Yoklama kapandƒ±.';
                    document.getElementById('timer').style.background = '#ff4444';
                    return;
                }
                
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                document.getElementById('timer').textContent = `‚è±Ô∏è Kalan S√ºre: ${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }
        
        async function checkWifiConnection(requiredWifi) {
            const statusDiv = document.getElementById('wifi-status-display');
            
            // Network Information API kontrol√º (sadece HTTPS'de √ßalƒ±≈üƒ±r)
            if ('connection' in navigator && navigator.connection) {
                const connection = navigator.connection;
                
                statusDiv.innerHTML = `
                    <div class="wifi-status wifi-connected">
                        üì∂ Baƒülantƒ± Tipi: ${connection.effectiveType || 'Bilinmiyor'}
                        <br>
                        <small>Not: WiFi "${requiredWifi}" aƒüƒ±nda olmanƒ±z gerekiyor!</small>
                    </div>
                `;
                
                // Basit baƒülantƒ± kontrol√º
                if(!navigator.onLine) {
                    statusDiv.innerHTML = `
                        <div class="wifi-status wifi-error">
                            ‚ùå ƒ∞nternet baƒülantƒ±sƒ± yok! √úniversite WiFi'sine baƒülanƒ±n.
                        </div>
                    `;
                    return false;
                }
            } else {
                // API desteklenmiyorsa uyarƒ± g√∂ster
                statusDiv.innerHTML = `
                    <div class="warning-msg">
                        ‚ö†Ô∏è WiFi kontrol√º i√ßin HTTPS baƒülantƒ±sƒ± gerekli.
                        <br>√úniversite WiFi'si: "${requiredWifi}" aƒüƒ±na baƒülƒ± olduƒüunuzdan emin olun!
                    </div>
                `;
            }
            
            return true;
        }
        
        function submitAttendance() {
            const sessionCode = document.getElementById('sessionInput').value;
            const studentNumber = document.getElementById('studentNumber').value;
            const studentName = document.getElementById('studentName').value;
            
            if(!sessionCode || !studentNumber || !studentName) {
                showStudentMessage('L√ºtfen t√ºm alanlarƒ± doldurun!', 'error');
                return;
            }
            
            // Session kontrol√º
            const session = sessions[sessionCode];
            if(!session) {
                showStudentMessage('Ge√ßersiz oturum kodu! Hocadan QR kodu tekrar g√∂stermesini isteyin.', 'error');
                return;
            }
            
            // S√ºre kontrol√º
            if(Date.now() > session.endTime) {
                showStudentMessage('Yoklama s√ºresi dolmu≈ü!', 'error');
                return;
            }
            
            // WiFi kontrol√º (basitle≈ütirilmi≈ü)
            if(session.wifiName && !navigator.onLine) {
                showStudentMessage(`√úniversite WiFi aƒüƒ±na (${session.wifiName}) baƒülƒ± deƒüilsiniz!`, 'error');
                return;
            }
            
            // Tekrar giri≈ü kontrol√º
            if(session.students.find(s => s.number === studentNumber)) {
                showStudentMessage('Bu numarayla zaten yoklama girilmi≈ü!', 'error');
                return;
            }
            
            // √ñƒürenciyi ekle
            const student = {
                number: studentNumber,
                name: studentName,
                time: new Date().toLocaleTimeString('tr-TR')
            };
            
            session.students.push(student);
            
            // Eƒüer bu hoca sekmesindeyse g√ºncelle
            if(currentSessionCode === sessionCode) {
                updateStudentList();
            }
            
            showStudentMessage('‚úÖ Yoklama ba≈üarƒ±yla kaydedildi!', 'success');
            
            // Formu temizle
            document.getElementById('studentNumber').value = '';
            document.getElementById('studentName').value = '';
        }
        
        function showStudentMessage(message, type) {
            const msgDiv = document.getElementById('student-message');
            msgDiv.className = type === 'error' ? 'error-msg' : 'success-msg';
            msgDiv.textContent = message;
            msgDiv.style.display = 'block';
            
            setTimeout(() => {
                msgDiv.style.display = 'none';
            }, 4000);
        }
        
        function updateStudentList() {
            const session = sessions[currentSessionCode];
            if(!session) return;
            
            const listDiv = document.getElementById('students');
            if(!listDiv) return;
            
            listDiv.innerHTML = session.students.map(s => 
                `<div class="student-item">
                    <span><strong>${s.number}</strong> - ${s.name}</span>
                    <span style="color: #666; font-size: 14px;">${s.time}</span>
                </div>`
            ).join('');
            
            document.getElementById('student-count').textContent = `Toplam: ${session.students.length} √ñƒürenci`;
        }
        
        function downloadExcel() {
            const session = sessions[currentSessionCode];
            if(!session || session.students.length === 0) {
                alert('Hen√ºz yoklama giren √∂ƒürenci yok!');
                return;
            }
            
            // CSV formatƒ±nda olu≈ütur
            let csv = '\uFEFF'; // BOM for UTF-8
            csv += 'Ders Kodu,Ders Adƒ±,Hafta,Tarih\n';
            csv += `${session.courseCode},${session.courseName},${session.week},${session.startTime}\n\n`;
            csv += '√ñƒürenci No,Ad Soyad,Giri≈ü Saati,Durum\n';
            csv += session.students.map(s => 
                `${s.number},${s.name},${s.time},Mevcut`
            ).join('\n');
            
            // ƒ∞ndir
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Yoklama_${session.courseCode}_Hafta${session.week}_${new Date().toLocaleDateString('tr-TR').replace(/\./g, '-')}.csv`;
            link.click();
        }
        
        function endSession() {
            if(confirm('Yoklamayƒ± bitirmek istediƒüinize emin misiniz?')) {
                // Timer'ƒ± durdur
                if(timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                
                // G√∂r√ºn√ºmleri deƒüi≈ütir
                document.getElementById('setup-form').style.display = 'block';
                document.getElementById('qr-display').style.display = 'none';
                
                // Oturumu sil
                if(currentSessionCode) {
                    delete sessions[currentSessionCode];
                    currentSessionCode = null;
                }
                
                // Formu temizle (WiFi hari√ß - varsayƒ±lan deƒüer kalsƒ±n)
                document.getElementById('courseName').value = '';
                document.getElementById('courseCode').value = '';
                document.getElementById('week').value = '';
                document.getElementById('duration').value = '5';
                document.getElementById('baseUrl').value = '';
                
                // √ñƒürenci listesini temizle
                document.getElementById('students').innerHTML = '';
                document.getElementById('student-count').textContent = 'Toplam: 0 √ñƒürenci';
            }
        }
    </script>
</body>
</html>
